import { create } from 'zustand';
import AsyncStorage from '@react-native-async-storage/async-storage';

export type Language = 'cs' | 'en';

export interface LanguageInfo {
  code: Language;
  name: string;
  flag: string;
}

export const LANGUAGES: Record<Language, LanguageInfo> = {
  cs: { code: 'cs', name: 'ƒåe≈°tina', flag: 'üá®üáø' },
  en: { code: 'en', name: 'English', flag: 'üá∫üá∏' },
};

// Translation keys and their values for each language
export const TRANSLATIONS = {
  cs: {
    // Tab names
    overview: 'P≈ôehled',
    add: 'P≈ôidat',
    learn: 'Uƒçit se',
    investments: 'Investice',
    profile: 'Profil',
    moneyBuddy: 'MoneyBuddy',
    chat: 'Chat',
    
    // Common
    save: 'Ulo≈æit',
    cancel: 'Zru≈°it',
    delete: 'Smazat',
    edit: 'Upravit',
    back: 'Zpƒõt',
    next: 'Dal≈°√≠',
    previous: 'P≈ôedchoz√≠',
    loading: 'Naƒç√≠t√°n√≠...',
    error: 'Chyba',
    success: '√öspƒõch',
    confirm: 'Potvrdit',
    close: 'Zav≈ô√≠t',
    
    // Overview screen
    totalBalance: 'Celkov√Ω z≈Østatek',
    monthlyIncome: 'Mƒõs√≠ƒçn√≠ p≈ô√≠jem',
    monthlyExpenses: 'Mƒõs√≠ƒçn√≠ v√Ωdaje',
    savings: '√öspory',
    quickActions: 'Rychl√© akce',
    addIncome: 'P≈ôidat p≈ô√≠jem',
    addExpense: 'P≈ôidat v√Ωdaj',
    viewReports: 'Zobrazit reporty',
    recentTransactions: 'Ned√°vn√© transakce',
    viewAll: 'Zobrazit v≈°e',
    
    // Add screen
    addTransaction: 'P≈ôidat transakci',
    income: 'P≈ô√≠jem',
    expense: 'V√Ωdaj',
    amount: 'ƒå√°stka',
    description: 'Popis',
    category: 'Kategorie',
    date: 'Datum',
    selectCategory: 'Vybrat kategorii',
    enterAmount: 'Zadejte ƒç√°stku',
    enterDescription: 'Zadejte popis',
    
    // Categories
    food: 'J√≠dlo',
    transport: 'Doprava',
    housing: 'Bydlen√≠',
    entertainment: 'Z√°bava',
    healthcare: 'Zdravotnictv√≠',
    shopping: 'N√°kupy',
    education: 'Vzdƒõl√°n√≠',
    other: 'Ostatn√≠',
    salary: 'Plat',
    freelance: 'Freelance',
    investment: 'Investice',
    gift: 'D√°rek',
    
    // Learn screen
    financialEducation: 'Finanƒçn√≠ vzdƒõl√°n√≠',
    lessons: 'Lekce',
    quizzes: 'Kv√≠zy',
    progress: 'Pokrok',
    completedLessons: 'Dokonƒçen√© lekce',
    availableLessons: 'Dostupn√© lekce',
    startLesson: 'Zaƒç√≠t lekci',
    takeQuiz: 'Absolvovat kv√≠z',
    
    // Lesson titles
    whatIsInflation: 'Co je inflace?',
    compoundInterest: 'Slo≈æen√© √∫roƒçen√≠',
    stocksVsEtfs: 'Akcie vs ETF',
    riskManagement: '≈ò√≠zen√≠ rizik',
    diversification: 'Diverzifikace',
    
    // Investment screen
    portfolio: 'Portfolio',
    totalValue: 'Celkov√° hodnota',
    todayChange: 'Dne≈°n√≠ zmƒõna',
    addTrade: 'P≈ôidat obchod',
    buy: 'Koupit',
    sell: 'Prodat',
    symbol: 'Symbol',
    shares: 'Akcie',
    price: 'Cena',
    analysis: 'Anal√Ωza',
    importPortfolio: 'Importovat portfolio',
    
    // Profile screen
    myProfile: 'M≈Øj profil',
    financialGoals: 'Finanƒçn√≠ c√≠le',
    monthlyReport: 'Mƒõs√≠ƒçn√≠ report',
    general: 'Obecn√©',
    
    // Settings
    settings: 'Nastaven√≠',
    language: 'Jazyk',
    currency: 'Mƒõna',
    theme: 'T√©ma',
    notifications: 'Ozn√°men√≠',
    privacy: 'Soukrom√≠',
    help: 'N√°povƒõda a podpora',
    
    // Theme settings
    lightMode: 'Svƒõtl√Ω re≈æim',
    darkMode: 'Tmav√Ω re≈æim',
    systemDefault: 'Podle syst√©mu',
    
    // Currency settings
    currencySettings: 'Nastaven√≠ mƒõny',
    selectCurrency: 'Vyber si preferovanou mƒõnu',
    wholeApp: 'Cel√° aplikace',
    investmentsOnly: 'Pouze investice',
    czechCrown: 'ƒåesk√° koruna (CZK)',
    euro: 'Euro (EUR)',
    usDollar: 'Americk√Ω dolar (USD)',
    
    // Language settings
    languageSettings: 'Jazyk aplikace',
    selectLanguage: 'Vyber si preferovan√Ω jazyk',
    
    // Financial goals
    setGoals: 'Nastavit c√≠le',
    savingGoal: 'C√≠l spo≈ôen√≠',
    spendingLimit: 'Limit v√Ωdaj≈Ø',
    emergencyFund: 'Nouzov√Ω fond',
    investmentTarget: 'Investiƒçn√≠ c√≠l',
    
    // MoneyBuddy Chat
    askMoneyBuddy: 'Zeptej se MoneyBuddy',
    typeMessage: 'Napi≈°te zpr√°vu...',
    send: 'Odeslat',
    
    // Notifications
    budgetAlert: 'Upozornƒõn√≠ na rozpoƒçet',
    goalReminder: 'P≈ôipom√≠nka c√≠l≈Ø',
    investmentUpdate: 'Aktualizace investic',
    
    // Reports
    monthlyOverview: 'Mƒõs√≠ƒçn√≠ p≈ôehled',
    expenseBreakdown: 'Rozlo≈æen√≠ v√Ωdaj≈Ø',
    incomeAnalysis: 'Anal√Ωza p≈ô√≠jm≈Ø',
    savingsProgress: 'Pokrok v spo≈ôen√≠',
    
    // Additional Czech translations
    hello: 'Ahoj',
    dailyTip: 'Tip dne',
    financialOverview: 'P≈ôehled financ√≠',
    transactions: 'Transakce',
    totalRecorded: 'celkem zaznamen√°no',
    completed: 'dokonƒçeno',
    financialRecommendations: 'Finanƒçn√≠ doporuƒçen√≠',
    invest: 'Investuj',
    monthlyIncomePercent: '% z p≈ô√≠jm≈Ø mƒõs√≠ƒçnƒõ',
    emergencyFundReserve: 'Rezerva',
    achievements: '√öspƒõchy',
    user: 'u≈æivatel',
    points: 'bod≈Ø',
    progressTo: 'Pokrok k',
    pointsLeft: 'bod≈Ø zb√Ωv√°',
    privacySecurity: 'Soukrom√≠ a bezpeƒçnost',
    protectData: 'Ochrana tv√Ωch dat',
    generalSettings: 'Obecn√© nastaven√≠',
    additionalOptions: 'Dal≈°√≠ mo≈ænosti',
    faqContact: 'FAQ a kontakt',
    noTransactionsYet: 'Zat√≠m ≈æ√°dn√© transakce',
    startAddingTransactions: 'Zaƒçni p≈ôid√°v√°n√≠m sv√Ωch p≈ô√≠jm≈Ø a v√Ωdaj≈Ø',
    recordTransactions: 'Zaznamenej sv√© p≈ô√≠jmy a v√Ωdaje',
    exampleSalary: 'Nap≈ô. V√Ωplata',
    exampleShopping: 'Nap≈ô. N√°kup v obchodƒõ',
    errorMessage: 'Chyba',
    fillAllFields: 'Vypl≈à v≈°echna pole',
    enterValidAmount: 'Zadej platnou ƒç√°stku',
    successMessage: '√öspƒõch',
    transactionAdded: 'Transakce byla p≈ôid√°na!',
    addedIncome: 'Super! P≈ôidal jsi p≈ô√≠jem',
    dontForgetInvest: 'Nezapome≈à ƒç√°st investovat! üí∞',
    recordedExpense: 'Zaznamenal jsem v√Ωdaj',
    watchBudget: 'Hl√≠dej si rozpoƒçet! üìä',
    more: 'V√≠ce',
    less: 'M√©nƒõ',
  },
  en: {
    // Tab names
    overview: 'Overview',
    add: 'Add',
    learn: 'Learn',
    investments: 'Investments',
    profile: 'Profile',
    moneyBuddy: 'MoneyBuddy',
    chat: 'Chat',
    
    // Common
    save: 'Save',
    cancel: 'Cancel',
    delete: 'Delete',
    edit: 'Edit',
    back: 'Back',
    next: 'Next',
    previous: 'Previous',
    loading: 'Loading...',
    error: 'Error',
    success: 'Success',
    confirm: 'Confirm',
    close: 'Close',
    
    // Overview screen
    totalBalance: 'Total Balance',
    monthlyIncome: 'Monthly Income',
    monthlyExpenses: 'Monthly Expenses',
    savings: 'Savings',
    quickActions: 'Quick Actions',
    addIncome: 'Add Income',
    addExpense: 'Add Expense',
    viewReports: 'View Reports',
    recentTransactions: 'Recent Transactions',
    viewAll: 'View All',
    
    // Add screen
    addTransaction: 'Add Transaction',
    income: 'Income',
    expense: 'Expense',
    amount: 'Amount',
    description: 'Description',
    category: 'Category',
    date: 'Date',
    selectCategory: 'Select Category',
    enterAmount: 'Enter amount',
    enterDescription: 'Enter description',
    
    // Categories
    food: 'Food',
    transport: 'Transport',
    housing: 'Housing',
    entertainment: 'Entertainment',
    healthcare: 'Healthcare',
    shopping: 'Shopping',
    education: 'Education',
    other: 'Other',
    salary: 'Salary',
    freelance: 'Freelance',
    investment: 'Investment',
    gift: 'Gift',
    
    // Learn screen
    financialEducation: 'Financial Education',
    lessons: 'Lessons',
    quizzes: 'Quizzes',
    progress: 'Progress',
    completedLessons: 'Completed Lessons',
    availableLessons: 'Available Lessons',
    startLesson: 'Start Lesson',
    takeQuiz: 'Take Quiz',
    
    // Lesson titles
    whatIsInflation: 'What is Inflation?',
    compoundInterest: 'Compound Interest',
    stocksVsEtfs: 'Stocks vs ETFs',
    riskManagement: 'Risk Management',
    diversification: 'Diversification',
    
    // Investment screen
    portfolio: 'Portfolio',
    totalValue: 'Total Value',
    todayChange: 'Today\'s Change',
    addTrade: 'Add Trade',
    buy: 'Buy',
    sell: 'Sell',
    symbol: 'Symbol',
    shares: 'Shares',
    price: 'Price',
    analysis: 'Analysis',
    importPortfolio: 'Import Portfolio',
    
    // Profile screen
    myProfile: 'My Profile',
    financialGoals: 'Financial Goals',
    monthlyReport: 'Monthly Report',
    general: 'General',
    
    // Settings
    settings: 'Settings',
    language: 'Language',
    currency: 'Currency',
    theme: 'Theme',
    notifications: 'Notifications',
    privacy: 'Privacy',
    help: 'Help & Support',
    
    // Theme settings
    lightMode: 'Light Mode',
    darkMode: 'Dark Mode',
    systemDefault: 'System Default',
    
    // Currency settings
    currencySettings: 'Currency Settings',
    selectCurrency: 'Select your preferred currency',
    wholeApp: 'Whole App',
    investmentsOnly: 'Investments Only',
    czechCrown: 'Czech Crown (CZK)',
    euro: 'Euro (EUR)',
    usDollar: 'US Dollar (USD)',
    
    // Language settings
    languageSettings: 'App Language',
    selectLanguage: 'Select your preferred language',
    
    // Financial goals
    setGoals: 'Set Goals',
    savingGoal: 'Saving Goal',
    spendingLimit: 'Spending Limit',
    emergencyFund: 'Emergency Fund',
    investmentTarget: 'Investment Target',
    
    // MoneyBuddy Chat
    askMoneyBuddy: 'Ask MoneyBuddy',
    typeMessage: 'Type a message...',
    send: 'Send',
    
    // Notifications
    budgetAlert: 'Budget Alert',
    goalReminder: 'Goal Reminder',
    investmentUpdate: 'Investment Update',
    
    // Reports
    monthlyOverview: 'Monthly Overview',
    expenseBreakdown: 'Expense Breakdown',
    incomeAnalysis: 'Income Analysis',
    savingsProgress: 'Savings Progress',
    
    // Additional English translations
    hello: 'Hello',
    dailyTip: 'Daily Tip',
    financialOverview: 'Financial Overview',
    transactions: 'Transactions',
    totalRecorded: 'total recorded',
    completed: 'completed',
    financialRecommendations: 'Financial Recommendations',
    invest: 'Invest',
    monthlyIncomePercent: '% of monthly income',
    emergencyFundReserve: 'Emergency Fund',
    achievements: 'Achievements',
    user: 'user',
    points: 'points',
    progressTo: 'Progress to',
    pointsLeft: 'points left',
    privacySecurity: 'Privacy & Security',
    protectData: 'Protect your data',
    generalSettings: 'General Settings',
    additionalOptions: 'Additional options',
    faqContact: 'FAQ and contact',
    noTransactionsYet: 'No transactions yet',
    startAddingTransactions: 'Start by adding your income and expenses',
    recordTransactions: 'Record your income and expenses',
    exampleSalary: 'e.g. Salary',
    exampleShopping: 'e.g. Shopping',
    errorMessage: 'Error',
    fillAllFields: 'Fill all fields',
    enterValidAmount: 'Enter valid amount',
    successMessage: 'Success',
    transactionAdded: 'Transaction added!',
    addedIncome: 'Great! You added income',
    dontForgetInvest: 'Don\'t forget to invest some! üí∞',
    recordedExpense: 'Recorded expense',
    watchBudget: 'Watch your budget! üìä',
    more: 'More',
    less: 'Less',
  },

};

interface LanguageState {
  language: Language;
  isLoaded: boolean;
  updateCounter: number;
  setLanguage: (language: Language) => void;
  loadLanguage: () => Promise<void>;
  t: (key: keyof typeof TRANSLATIONS.cs) => string;
}

export const useLanguageStore = create<LanguageState>((set, get) => ({
  language: 'cs',
  isLoaded: false,
  updateCounter: 0,

  setLanguage: async (language: Language) => {
    console.log('Setting language to:', language);
    try {
      await AsyncStorage.setItem('language', language);
      console.log('Language saved successfully:', language);
      // Force re-render by updating counter and language together
      set({ 
        language, 
        isLoaded: true, 
        updateCounter: get().updateCounter + 1 
      });
    } catch (error) {
      console.error('Failed to save language:', error);
    }
  },

  loadLanguage: async () => {
    try {
      const savedLanguage = await AsyncStorage.getItem('language');
      const language = (savedLanguage as Language) || 'cs';
      console.log('Loading language:', language, 'from storage:', savedLanguage);
      set({ language, isLoaded: true, updateCounter: 0 });
    } catch (error) {
      console.error('Failed to load language:', error);
      set({ language: 'cs', isLoaded: true, updateCounter: 0 });
    }
  },

  t: (key: keyof typeof TRANSLATIONS.cs) => {
    const { language } = get();
    const translation = TRANSLATIONS[language]?.[key] || TRANSLATIONS.cs[key];
    return translation || key;
  },
}));